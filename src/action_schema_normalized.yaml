# plant config
events:
  # alert example
  - event_type: SensorData
    id: 1
    field:
      name: soil_moisture
      score_method: TargetValueScore
      rating_threshold_overrides:
        maximum_value: 90
        minimum_value: 20
      query:
        value:
          query_type: Average
          query_min: 2m
          query_max: 10m
        slope:
          query_type: Slope
          query_min: 2m
          query_max: 10m
    triggers:
      - on:
          and:
            value:
              equals: TooLow
            slope:
              less_than:
                0
        execute:
          - 1
      - on:
          values: Low
        execute:
          - 2
      - on:
          values: Nominal
        execute:
          - action_type: ClearAlert
      - on:
          values: High
        execute:
          - 3
  # actuator example
  - event_type: SensorData
    id: 2
    field:
      name: light
      score_function: TargetValueScore
      query:
        query_type: Sum
        query_min: 2m
        query_max: 24hr
    triggers:
      - on:
          value: TooLow
        execute:
          - 4
          - 5
      - on:
          value: Nominal
        execute:
          - action_type: ClearAlert
          - action_type: Actuator
            actuator_1:
              enabled: false
actions:
  - action_type: GenerateAlert
    id: 1
    message_template: '{plant.plant_name} needs water!'
    severity: Critical
    disabled: true
    cooldown: 24hr
  - action_type: GenerateAlert
    id: 2
    message_template: '{plant.plant_name} will need water soon.'
    severity: Warning
    cooldown: 24hr
  - action_type: GenerateAlert
    id: 3
    message_template: '{plant.plant_name} has too much water, try using less water next time.'
    severity: Warning
  - action_type: Actuator
    id: 4
    actuator_1:
      enabled: true
  - action_type: GenerateAlert
    id: 5
    message_template: '{plant.plant_name} needs more light. Turning on the light'
    severity: Info

# device config
events:
  - event_type: ValueChange
    id: 1
    field:
      name: battery_level
      query:
        query_type: Value
    triggers:
      - on:
          less_than: 10
        execute:
          - action_type: GenerateAlert
            message_template: '{device.name} is almost out of battery'
            severity: Critical
      - on:
          between:
            min: 10
            max: 50
        execute:
          - action_type: GenerateAlert
            message_template: '{device.name} needs new batteries soon'
            severity: Warning
            send_once: true
      - on:
          greater_than: 55
        execute:
          - action_type: ClearAlert

  - event_type: StateChange
    id: 2
    triggers:
      - on:
          value: Connected
        execute:
          - action_type: ClearAlert
      - on:
          values: Disconnected
        execute:
          - action_type: GenerateAlert
            message_template: '{device.name} lost connection'
            severity: Warning
      - on:
          values: Error
        execute:
          - action_type: GenerateAlert
            message_template: '{device.name} has encountered an error. {device.stack_trace}'
            severity: Error
